# Copilot Instructions â€” PayTread

These instructions are for code generation assistants (Copilot, ChatGPT coding helpers) and any automated tooling that suggests code changes. They must be followed strictly.

- PayTread uses Priority Payments rails for all payments and payouts.
- Do NOT generate code for Stripe, Dwolla, PayPal, Square, Adyen, or any other third-party payment provider.
- Implement all payment logic through `lib/payments` using the `PaymentsProvider` interface defined in `lib/payments/types.ts`.
- Only provider implementation allowed in the repo: `PriorityPaymentsProvider` under `lib/payments/priority/`.
- All inbound events/webhooks from Priority MUST be handled only inside `app/api/webhooks/priority/route.ts`.
- Never store or log sensitive payment credentials (PAN, full bank account numbers, CVV, full routing numbers).
  - Store only provider tokens/IDs and `last4` where appropriate.
- All payout state changes (create, sent, failed, reversed) MUST create immutable ledger entries.
  - Ledger entries should be appended to the append-only ledger (`WalletTransaction` / `LedgerEntry`) and reference the related `load` and `payout` when applicable.

When adding or modifying payment code, ensure unit tests or integration tests verify:
- All payment calls are routed via the `PaymentsProvider` interface.
- No raw PAN or full account numbers are written to the DB or logs.

Developer note: If a local sandbox/mock is required for development, implement it as `lib/payments/priority/sandbox.ts` and ensure it's used only behind a dev-only switch; production must wire the real `PriorityPaymentsProvider`.
